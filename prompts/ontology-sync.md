# Промпт: Ontology Sync

> **Роль:** Knowledge Extractor в режиме онтологической синхронизации
> **Когда вызывается:** После изменения ontology.md в любом Pack, или по запросу пользователя
> **Связанный процесс:** DS-extractor-agent/PROCESSES.md → Process 7

---

## Контекст

Общая мастер-онтология: `DS-ecosystem-development/ontology.md` — агрегированный индекс общих понятий (DP + ECO + MIM, 31 понятие).
Личная онтология: `DS-my-strategy/ontology.md` — персональные понятия (PD, 9 понятий) + ссылка на общую.

Pack-онтологии:
- `PACK-personal/ontology.md` (PD) — личный
- `PACK-digital-platform/ontology.md` (DP) — общий
- `PACK-ecosystem/ontology.md` (ECO) — общий
- `PACK-MIM/ontology.md` (MIM) — общий

Downstream-онтологии (ссылаются на общую мастер-онтологию):
- `DS-ecosystem-development/ontology.md` (= общая мастер-онтология)
- `DS-my-strategy/ontology.md` (= личная онтология)
- другие downstream: ссылаются, не определяют

---

## Конфигурация

> Перед обработкой прочитай:
> 1. `~/Github/DS-extractor-agent/config/routing.md` — таблицы маршрутизации (Pack'и, типы, директории)
> 2. `~/Github/DS-extractor-agent/config/feedback-log.md` — лог отклонённых кандидатов (не предлагай аналогичные)

## Алгоритм

### Шаг 1: Определить изменения

```bash
# Для конкретного Pack:
cd <PACK-repo> && git log --oneline -5 -- ontology.md

# Или сравнить мастер-онтологию со всеми Pack:
# Прочитать DS-my-strategy/ontology.md → извлечь список понятий
# Прочитать каждый Pack/ontology.md → извлечь список понятий
# Найти расхождения
```

### Шаг 2: Направление синхронизации

**Правило двунаправленности:**

| Событие | Действие |
|---------|----------|
| Новое понятие в Pack ontology.md | → Добавить в общую мастер-онтологию (DS-ecosystem-development/ontology.md) |
| Понятие изменилось в Pack | → Обновить определение в мастер-онтологии |
| Понятие удалено из Pack | → Пометить в мастер-онтологии как removed |
| Новое понятие в мастер-онтологии без ссылки на Pack | → ОШИБКА: каждое понятие должно иметь Pack-источник |

### Шаг 3: Проверить Downstream

Для каждого Downstream-репо, который ссылается на изменённый Pack:
1. Прочитать `<downstream>/ontology.md`
2. Проверить: используемые понятия ещё существуют?
3. Проверить: новые понятия Pack нужны этому Downstream?

### Шаг 4: Сформировать Ontology Sync Report

```markdown
## Ontology Sync Report

**Дата:** YYYY-MM-DD
**Триггер:** [какой Pack изменился / запрос пользователя]

### Изменения в Pack

| Pack | Понятие | Тип изменения | Определение |
|------|---------|--------------|-------------|
| MIM | MIM.FMT.005 | ADDED | Новый формат: ... |
| PD | PD.CHR.002 | UPDATED | Уточнение определения |

### Обновления мастер-онтологии

| Секция | Строка | Было | Стало |
|--------|--------|------|-------|
| MIM | row 5 | — | + MIM.FMT.005: ... |

### Обновления Downstream

| Downstream | Файл | Изменение | Критичность |
|-----------|------|-----------|-------------|
| DS-ecosystem-dev | ontology.md | + MIM.FMT.005 в ядро D | low |

### Статистика

| Метрика | Значение |
|---------|----------|
| Понятий в мастер-онтологии | NN |
| Расхождений найдено | NN |
| Обновлений предложено | NN |
```

### Шаг 5: Применить одобренные изменения

1. Показать Sync Report → получить одобрение
2. Обновить `DS-my-strategy/ontology.md`
3. Обновить затронутые Downstream ontology.md
4. Закоммитить с сообщением: `ontology-sync: [описание]`

---

## Правила

1. **Не модифицировать Pack ontology.md** — Pack = source-of-truth, изменения идут только ОТ Pack
2. **Каждое понятие в мастер-онтологии должно иметь Pack-источник** — нет «висящих» понятий
3. **Downstream ≠ source-of-truth** — Downstream только ссылается, не создаёт новых доменных понятий
4. **Не применять без одобрения** — Sync Report → пользователь подтверждает → только тогда коммит
5. **Проверять кросс-Pack связи** — изменение в одном Pack может затрагивать связи с другими
6. **Обновлять статистику** — секция 4 мастер-онтологии (количество понятий) актуальна

---

## Валидация

- [ ] Все понятия мастер-онтологии имеют Pack-источник (колонка «Сущность»)
- [ ] Все понятия из Pack ontology.md присутствуют в мастер-онтологии
- [ ] Кросс-Pack связи в секции 3 актуальны
- [ ] Downstream ontology.md ссылается на актуальные понятия
- [ ] Статистика в секции 4 корректна
